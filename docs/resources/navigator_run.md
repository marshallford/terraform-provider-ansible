---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ansible_navigator_run Resource - terraform-provider-ansible"
subcategory: ""
description: |-
  Run an Ansible playbook within an execution environment (EE). Requires ansible-navigator and a container engine to run the EEI.
---

# ansible_navigator_run (Resource)

Run an Ansible playbook within an execution environment (EE). Requires `ansible-navigator` and a container engine to run the EEI.

## Example Usage

```terraform
# 1. inline playbook and inventory
resource "ansible_navigator_run" "inline" {
  playbook = <<-EOT
  - hosts: some_group
    become: false
    tasks:
    - ansible.builtin.debug:
        msg: "{{ some_var }}"
  EOT
  inventory = yamlencode({
    all = {
      children = {
        some_group = {
          hosts = {
            local_container = {
              ansible_connection = "local"
              some_var           = "hello world!"
            }
          }
        }
      }
    }
  })
}

# 2. existing playbook and inventory
resource "ansible_navigator_run" "existing" {
  playbook  = file("playbook.yaml")
  inventory = file("inventory/baremetal.yaml")
}

# 3. use custom modules, module utils, filter plugins, and roles

# ansible.cfg file in some-directory
# [defaults]
# library=library
# module_utils=module_utils
# filter_plugins=filter_plugins
# roles_path=roles
# ...

resource "ansible_navigator_run" "working_directory" {
  playbook          = "..."
  inventory         = "..."
  working_directory = "some-directory"
}

# 4. set and pass environment variables
resource "ansible_navigator_run" "environment_variables" {
  playbook  = <<-EOT
  - hosts: all
    tasks:
    - ansible.builtin.debug:
        msg: "{{ item }}"
      loop:
      - "{{ lookup('ansible.builtin.env', 'SOME_VAR') }}"
      - "{{ lookup('ansible.builtin.env', 'EDITOR') }}"
  EOT
  inventory = "..."
  execution_environment = {
    environment_variables_set = {
      "SOME_VAR" = "some-value"
    }
    environment_variables_pass = [
      "EDITOR",
    ]
  }
}

# 5. ansible playbook options
resource "ansible_navigator_run" "ansible_options" {
  playbook  = "..."
  inventory = "..."
  ansible_options = {
    force_handlers = true               # --force-handlers
    skip_tags      = ["tag1", "tag2"]   # --skip-tags tag1,tag2
    start_at_task  = "task name"        # --start-at-task task name
    limit          = ["host1", "host2"] # --limit host1,host2
    tags           = ["tag3", "tag4"]   # --tags tag3,tag4
  }
}

# 6. run on destroy
resource "ansible_navigator_run" "destroy" {
  playbook       = <<-EOT
  - hosts: all
    tasks:
    - ansible.builtin.set_fact:
        destroy: "{{ lookup('ansible.builtin.env', 'ANSIBLE_TF_OPERATION') == 'destroy' }}"
    - ansible.builtin.debug:
        msg: "resource is being destroyed!"
      when: destroy
  EOT
  inventory      = "..."
  run_on_destroy = true
}

# 7. triggers and replacement triggers
resource "ansible_navigator_run" "triggers" {
  playbook  = "..."
  inventory = "..."
  triggers = {
    somekey = some_resource.example.id # re-run playbook when id changes
  }
  replacement_triggers = {
    somekey = some_resource.example.id # recreate resource when id changes
  }
}

# 8. artifact queries -- get playbook stdout
resource "ansible_navigator_run" "artifact_query_stdout_example" {
  playbook  = "..."
  inventory = "..."
  artifact_queries = {
    "stdout" = {
      jsonpath = "$.stdout"
    }
  }
}

output "playbook_stdout" {
  value = join("\n", jsondecode(ansible_navigator_run.artifact_query_stdout_example.artifact_queries.stdout.result))
}

# 9. artifact queries -- get file contents
resource "ansible_navigator_run" "artifact_query_file_example" {
  playbook  = <<-EOT
  - name: Get file
    hosts: all
    become: false
    tasks:
    - name: resolv.conf
      ansible.builtin.slurp:
        src: /etc/resolv.conf
  EOT
  inventory = "..."
  artifact_queries = {
    "resolv_conf" = {
      jsonpath = "$.plays[?(@.__play_name=='Get file')].tasks[?(@.__task=='resolv.conf')].res.content"
    }
  }
}

output "resolv_conf" {
  value = base64decode(ansible_navigator_run.artifact_query_file_example.artifact_queries.resolv_conf.result)
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `inventory` (String) Ansible [inventory](https://docs.ansible.com/ansible/latest/getting_started/get_started_inventory.html) contents.
- `playbook` (String) Ansible [playbook](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_intro.html) contents.

### Optional

- `ansible_navigator_binary` (String) Path to the `ansible-navigator` binary. By default `$PATH` is searched.
- `ansible_options` (Attributes) Ansible [playbook](https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html) run related configuration. (see [below for nested schema](#nestedatt--ansible_options))
- `artifact_queries` (Attributes Map) Query the playbook artifact with [JSONPath](https://goessner.net/articles/JsonPath/). The [playbook artifact](https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.0-ea/html/ansible_navigator_creator_guide/assembly-troubleshooting-navigator_ansible-navigator#proc-review-artifact_troubleshooting-navigator) contains detailed information about every play and task, as well as the stdout from the playbook run. (see [below for nested schema](#nestedatt--artifact_queries))
- `execution_environment` (Attributes) [Execution environment](https://ansible.readthedocs.io/en/latest/getting_started_ee/index.html) related configuration. (see [below for nested schema](#nestedatt--execution_environment))
- `replacement_triggers` (Map of String) Arbitrary map of values that, when changed, will recreate the resource. Similar to `triggers`, but will cause `id` to change. Useful when combined with `run_on_destroy`.
- `run_on_destroy` (Boolean) Run playbook on destroy. The environment variable `ANSIBLE_TF_OPERATION` is set to `delete` during the run to allow for conditional plays, tasks, etc. Defaults to `false`.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))
- `timezone` (String) IANA time zone, use `local` for the system time zone. Defaults to `UTC`.
- `triggers` (Map of String) Arbitrary map of values that, when changed, will run the playbook again. Serves as alternative way to trigger a run without changing the inventory or playbook.
- `working_directory` (String) Directory which `ansible-navigator` is run from. Recommended to be the root Ansible [content directory](https://docs.ansible.com/ansible/latest/tips_tricks/sample_setup.html#sample-directory-layout) (sometimes called the project directory), which is likely to contain `ansible.cfg`, `roles/`, etc.

### Read-Only

- `command` (String) Generated `ansible-navigator` run command. Useful for troubleshooting.
- `id` (String) UUID.

<a id="nestedatt--ansible_options"></a>
### Nested Schema for `ansible_options`

Optional:

- `force_handlers` (Boolean) Run handlers even if a task fails.
- `limit` (List of String) Further limit selected hosts to an additional pattern.
- `private_keys` (Attributes List) SSH private keys used for authentication in addition to the [automatically mounted](https://ansible.readthedocs.io/projects/navigator/faq/#how-do-i-use-my-ssh-keys-with-an-execution-environment) default named keys and SSH agent socket path. (see [below for nested schema](#nestedatt--ansible_options--private_keys))
- `skip_tags` (List of String) Only run plays and tasks whose tags do not match these values.
- `start_at_task` (String) Start the playbook at the task matching this name.
- `tags` (List of String) Only run plays and tasks tagged with these values.

<a id="nestedatt--ansible_options--private_keys"></a>
### Nested Schema for `ansible_options.private_keys`

Required:

- `data` (String, Sensitive) Key data.
- `name` (String) Key name.



<a id="nestedatt--artifact_queries"></a>
### Nested Schema for `artifact_queries`

Required:

- `jsonpath` (String) JSONPath expression.

Read-Only:

- `result` (String) Result of the query. Result may be empty if a field or map key cannot be located.


<a id="nestedatt--execution_environment"></a>
### Nested Schema for `execution_environment`

Optional:

- `container_engine` (String) [Container engine](https://ansible.readthedocs.io/projects/navigator/settings/#container-engine) responsible for running the execution environment container image. Options: `auto`, `podman`, `docker`. Defaults to `auto`.
- `container_options` (List of String) [Extra parameters](https://ansible.readthedocs.io/projects/navigator/settings/#container-options) passed to the container engine command.
- `environment_variables_pass` (List of String) Existing environment variables to be [passed](https://ansible.readthedocs.io/projects/navigator/settings/#pass-environment-variable) through to and set within the execution environment.
- `environment_variables_set` (Map of String) Environment variables to be [set](https://ansible.readthedocs.io/projects/navigator/settings/#set-environment-variable) within the execution environment. By default `ANSIBLE_TF_OPERATION` is set to the current CRUD operation (`create`, `update`, `delete`).
- `image` (String) Name of the execution environment container [image](https://ansible.readthedocs.io/projects/navigator/settings/#execution-environment-image). Defaults to `ghcr.io/ansible/community-ansible-dev-tools:v24.7.0`.
- `pull_arguments` (List of String) Additional [parameters](https://ansible.readthedocs.io/projects/navigator/settings/#pull-arguments) that should be added to the pull command when pulling an execution environment container image from a container registry.
- `pull_policy` (String) Container image [pull policy](https://ansible.readthedocs.io/projects/navigator/settings/#pull-policy). Defaults to `tag`.


<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
